

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
 <link rel="icon" type="image/png" href="https://i.imgur.com/vQSIAZf.png">
<title>Marketplace</title>
<style>
    :root {
        --primary-color: #a83afd;      /* Modern purple */
        --secondary-color: #a83afd;    /* Fresh green */
        --accent-color: #a83afd;       /* Vibrant orange */
        --background-color: #f8f9fa;   /* Light gray */
        --text-color: #2c3e50;         /* Deep blue-gray */
        --card-color: #ffffff;         /* Pure white */
        --border-color: #e9ecef;       /* Light border */
    }
    body, html {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        -webkit-font-smoothing: antialiased;
        background-color: var(--background-color);
        color: var(--text-color);
    }
    .app {
        max-width: none; /* Remove max-width constraint */
        margin: 0;
        padding: 0;
        display: none;
        flex-direction: column;
        position: relative;
    }
    img {
        -webkit-user-drag: none;
        -khtml-user-drag: none;
        -moz-user-drag: none;
        -o-user-drag: none;
        user-drag: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -o-user-select: none;
        user-select: none;
        pointer-events: none;
    }
    @media (max-width: 755px) {
        .app {
            width: 100%;
            box-sizing: border-box;
        }
    }
    .header__container {
        background-color: white;
        margin-bottom: 30px;
    }
    .header {
        background: white;
        padding: 10px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        border-radius: 0;
        margin: 0;
        width: 100%;
        max-width: 900px;
        margin: 0 auto;
        box-sizing: border-box;
    }
   
    .logo {
        cursor: pointer;
        font-size: 24px;
        padding: 5px 15px;
        color: var(--text-color);
        border-radius: 8px;
        margin: 0;
        transition: ease 200ms;
    }
    .logo:hover {
        transform: scale(1.1);
    }
    .logo img {
        width: 50px;
    }
    .icons {
        display: flex;
        gap: 20px;
    }
    .icons img {
        width: 30px;
        height: 30px;
        filter: invert(19%) sepia(22%) saturate(955%) hue-rotate(168deg) brightness(92%) contrast(85%);
    }
    .icon-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        cursor: pointer;
        text-decoration: none;
        color: var(--text-color);
    }
    .icon-container svg {
        width: 24px;
        height: 24px;
        margin-bottom: 5px;
    }
    .icon-label {
        font-size: 14px;
        text-align: center;
    }
    .products {
        display: grid;
        grid-template-columns: repeat(4, minmax(200px, 1fr));
        gap: 20px;
        padding: 20px 0;
        max-width: 900px; /* Reduce from original value */
        margin: 0 auto; /* Centering the products section */
    }

    .ad-banner {
        grid-column: 1 / -1;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        padding: 40px;
        margin: 20px 0;
        border-radius: 12px;
        text-align: center;
        color: white;
        font-size: 48px;
        font-weight: 800;
        text-transform: uppercase;
        position: relative;
        overflow: hidden;
    }

    .ad-banner::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(45deg, transparent 25%, rgba(255,255,255,0.1) 25%, 
                    rgba(255,255,255,0.1) 50%, transparent 50%, transparent 75%, 
                    rgba(255,255,255,0.1) 75%, rgba(255,255,255,0.1));
        background-size: 30px 30px;
        animation: slide 20s linear infinite;
        opacity: 0.3;
    }

    @keyframes slide {
        0% { background-position: 0 0; }
        100% { background-position: 60px 60px; }
    }

    @media (max-width: 755px) {
        .ad-banner {
            font-size: 32px;
            padding: 20px;
        }
    }
    @media (max-width: 755px) {
        .products {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
        }
    }
    .product {
        background: white;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: stretch;
        border-radius: 16px;
        border: 1px solid var(--border-color);
        padding: 20px;
        position: relative;
        cursor: pointer;
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .product:hover {
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    .favorite {
        z-index: 100;
        width: 20px;
        height: 20px;
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 20px;
        color: var(--accent-color);
        background: white;
        padding: 8px;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        align-items: center;
        display: flex;
    }
    .discount-badge {
        top: 0;
        right: 0;
        background: var(--accent-color);
        color: white;
        padding: 3px 8px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
    }
    #discount-card {
        top: 10px;
        right: 10px;
        font-size: 26px;
        position: absolute;
    }
    .product-content h3 {
        font-size: 20px;
        font-weight: 400;
        margin: 0;
    }
    .product img {
        width: 100%;
        height: 180px;
        object-fit: contain;
        margin: 10px 0 20px;
        transition: transform 0.3s ease;
    }
    .product:hover img {
        transform: scale(1.05);
    }
    .price-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 10px 0px;
        font-size: 18px;
    }
    .original-price {
        color: #999;
        text-decoration: line-through;
        font-size: 14px;
    }
    .product-details .original-price {
        font-size: 18px;
    }
    .current-price {
        color: var(--text-color);
        font-weight: 700;
        font-size: 22px;
    }
    .premium-price {
        color: #ff6b6b;
        font-size: 16px;
        font-weight: 500;
    }
    .add-to-cart {
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 17px;
        font-weight: 400;
        border: none;
        transition: all 0.2s ease;
        width: 100%;
        margin-top: 10px;
    }
    .add-to-cart:hover {
        background-color: var(--accent-color);
    }
    .rating {
        color: gold;
        margin-top: 5px;
    }
    .product-details {
        background: white;
        padding: 40px 40px;
        margin-bottom: 40px;
        max-width: 800px; /* Changed from 1000px to 800px */
        margin-left: auto;
        margin-right: auto;
    }
    .product-layout {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 50px;
    }
    @media (max-width: 755px) {
        .product-layout {
            padding-inline: 8px;
            display: flex;
            flex-direction: column;
            gap: 30px;
        }
        .product-details {
            margin-bottom: 20px;
            padding: 5px;
        }
    }
    .product-image-container {
        position: relative;
        display: flex;
        align-items: center;
        width: 90%;
        margin: 0 auto;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .product-image-container img {
        width: 100%;
        height: auto;
        object-fit: cover;
    }
    .product-info {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .product-info h3 {
        margin-bottom: 0px;
        margin-top: 25px;
    }
    #product-price {
        font-size: 32px;
        font-weight: bold;
        color: black;
    }
    #product-rating {
        font-size: 24px;
        color: gold;
    }
    #product-description {
        margin: 0;
        margin-top: 15px;
        font-size: 16px;
        line-height: 1.5;
        color: var(--text-color);
    }
    #product-features {
        padding-left: 20px;
        margin: 10px 0;
    }
    #product-name {
        margin: 0;
    }
    .delivery-info {
        margin-top: 15px;
        padding: 10px;
        background: rgba(108, 99, 255, 0.1);
        border-radius: 8px;
    }
    .option-picker {
        display: flex;
        gap: 10px;
    }
    .option-button {
        padding: 5px 10px;
        border: 1px solid var(--primary-color);
        border-radius: 5px;
        background-color: var(--card-color);
        color: var(--primary-color);
        cursor: pointer;
    }
    .option-button.selected {
        background-color: var(--primary-color);
        color: var(--card-color);
    }
    #add-to-cart-btn {
        cursor: pointer;
        margin-top: 10px;
    }
    .buy-now-cart-btn {
        color: var(--primary-color);
        background-color: transparent;
        border-radius: 8px;
        padding: 12px 24px;
        font-size: 17px;
        font-weight: 400;
        border: none;
        transition: ease 200ms;
        width: 100%;
        margin-top: 10px;
        cursor: pointer;
    }
    .buy-now-cart-btn:hover {
        background-color: var(--primary-color);
        color: white;
    }
    .floating-cart {
        position: static;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        padding: 12px 24px;
        border-radius: 12px;
        margin-top: 15px;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        cursor: pointer;
    }
    .floating-cart button {
        width: 100%;
        background: none;
        border: none;
        color: white;
        font-size: 16px;
        font-weight: 500;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        cursor: pointer;
    }
    .floating-cart:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    .cart {
        max-width: 800px;
        width: 600px;
        margin: 0 auto;
        padding: 40px;
        background: linear-gradient(135deg, var(--background-color), white);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .back-to-catalog {
        display: flex;
        align-items: center;
        color: #6c7cff;
        cursor: pointer;
    }
    .back-to-catalog svg {
        width: 16px;
        height: 16px;
    }

    @media (max-width: 755px) {
        .cart {
            max-width: 800px;
            padding: 3%;
            border-radius: 0;
            min-height: 100vh;
            width: 90%;
        }

        .cart-item {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
        }

        .cart button[onclick="buttonOrder()"] {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            font-size: 1.1em;
            cursor: pointer;
        }
    }
    .cart-item {
        background: var(--card-color);
        margin: 10px 0;
        display: grid;
        grid-template-columns: auto 2fr 1fr 1fr auto;
        gap: 20px;
        align-items: center;
        padding: 20px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }
    .cart-item img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }
    @media (max-width: 755px) {
        .cart-item {
            display: flex;
            flex-direction: column;
            gap: 15px;
            padding: 15px;
        }
    }
    .cart-item:hover {
        background-color: rgba(255, 255, 255, 0.05);
    }
    .cart-item-name {
        flex-grow: 1;
        margin-right: 10px;
    }
    .cart-item-quantity {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .cart-item-quantity button {
        background-color: var(--primary-color);
        color: white;
        border: none;
        padding: 4px 8px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s;
        font-size: 16px;
        transition: ease 200ms;
    }
    .cart-item-quantity button:hover {
        background-color: var(--secondary-color);
    }
    .cart-item-price {
        font-weight: bold;
        color: black;
        margin: 0 15px;
    }
    #cart-total {
        margin-top: 20px;
        font-size: 1.2em;
        font-weight: bold;
        text-align: right;
        color: var(--secondary-color);
    }
    #cart-total div {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        font-size: 18px;
    }
    .cart button[onclick="buttonOrder()"] {
        display: block;
        width: 100%;
        padding: 15px;
        margin-top: 20px;
        background-color: var(--secondary-color);
        color: var(--text-color);
        border: none;
        border-radius: 10px;
        font-size: 1.1em;
        cursor: pointer;
        transition: background-color 0.3s;
    }
    .cart button[onclick="buttonOrder()"]:hover {
        background-color: var(--primary-color);
    }
    .product-details-nav {
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        color: var(--text-color);
        font-size: 16px;
    }
    .product-details-nav a {
        display: flex;
        align-items: center;
        gap: 5px;
        text-decoration: none;
        color: #6c7cff;
    }
    .product-details-nav a:hover {
        color: var(--secondary-color);
    }
    .product-details-nav .separator {
        margin: 0 10px;
        color: #999;
    }
    .option-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
    }
    .option-container button {
        width: 90px;
    }
    .empty-cart-message {
        text-align: center;
        padding: 40px;
        color: var(--text-color);
    }
    .payment-delivery-section {
        margin-top: 0px;
        padding: 0 20px;
        background: var(--card-color);
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }
    .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--text-color);
        margin-bottom: 15px;
    }
    .section-title svg {
        width: 24px;
        height: 24px;
    }
    .add-button {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px 20px;
        border-radius: 8px;
        border: none;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        cursor: pointer;
        transition: opacity 0.2s;
    }
    .add-button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }
    .add-button svg {
        width: 20px;
        height: 20px;
    }
    .helper-text {
        font-size: 14px;
        color: #666;
        margin-top: 8px;
    }
    .section-divider {
        height: 0px;
        background: var(--border-color);
        margin: 20px 0;
    }
    /* Add after .promo-banner styles */

    .product-presentation {
        /*  
        
        background: linear-gradient(135deg, #FFF, #a83afd);
            */

    background: 
        radial-gradient(circle at 35% 50%, rgba(255, 255, 255, 0.9) 5%, rgba(255, 255, 255, 0.5) 10%, rgba(255, 255, 255, 0) 15%), /* Белый кружок с еще меньшей яркостью */
        linear-gradient(135deg, #a73afd, yellow); /* Линейный градиент */


        padding: 60px 0px;
        position: relative;
        overflow: hidden;
        width: 100%;
        margin: 0 auto;
        margin-bottom: 40px;
    }
    .slideshow {
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        align-items: center;
        padding-bottom: 10px;
        width: 860px;
    }
    @media (max-width: 755px) {
        .slideshow {
            grid-template-columns: 1fr;
            gap: 20px;
            text-align: center;
        }
    }
    .slide-image {
        width: 90%;
        max-width: 500px;
        height: auto;
        object-fit: contain;
        filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
        transform: perspective(1000px) rotateY(-10deg);
        transition: transform 0.3s ease;

        /* сделать картинку прозрачной, слить с фоном*/
         mix-blend-mode: multiply;

        filter: contrast(1.1) drop-shadow(0 10px 20px rgba(0,0,0,0.2));
        -webkit-mask-image: radial-gradient(circle at center, black 70%, transparent 100%);
        mask-image: radial-gradient(circle at center, black 70%, transparent 100%);
    }
    .slide-content {
        color: white;
        padding: 20px;
    }
    .slide-title {
        font-size: 42px;
        font-weight: 800;
        margin: 0 0 20px;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
    }
    .slide-price {
        font-size: 32px;
        font-weight: 600;
        margin: 0 0 30px;
    }
    .slide-cta {
        background: white;
        color: var(--primary-color);
        border: none;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        margin-bottom: 35px;
    }
    .slide-cta:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    .slide-controls {
        position: absolute;
        display: flex;
        justify-content: center;
        width: 200px;
        gap: 10px;
    }
    .slide-dot {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        background: rgba(255,255,255,0.3);
        cursor: pointer;
        transition: background-color 0.2s ease;
    }
    .slide-dot.active {
        background: white;
    }
    .slide-progress {
        position: absolute;
        bottom: 0;
        left: 0;
        height: 4px;
        background: rgba(255,255,255,0.3);
        width: 100%;
    }
    .slide-progress-bar {
        height: 100%;
        background: white;
        width: 0;
        transition: width 0.1s linear;
    }
    .modal-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .address-modal {
        background: white;
        padding: 30px;
        border-radius: 12px;
        width: 90%;
        max-width: 500px;
        position: relative;
    }

    .close-modal {
        position: absolute;
        top: 15px;
        right: 15px;
        cursor: pointer;
        font-size: 24px;
        color: var(--text-color);
    }

    .address-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
    }

    .form-group {
        display: flex;
        flex-direction: column;
        gap: 5px;
    }

    .form-group label {
        font-weight: 500;
        color: var(--text-color);
    }

    .form-group input {
        padding: 8px 12px;
        border: 1px solid var(--border-color);
        border-radius: 6px;
    }

    .address-save-btn {
        margin-top: 20px;
        padding: 12px;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .address-save-btn:disabled {
        opacity: 0.7;
        cursor: not-allowed;
    }

    button[onclick="buttonOrder()"]:disabled {
        opacity: 0.7 !important;
        cursor: not-allowed;
        background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
    }
    .cart-item-name {
        font-size: 18px;
    }
    .cart-item-info {
        display: flex;
        margin-inline: 1%;
    }
    .cart-item-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 10px;
        margin-inline: 2%;
    }
    .cart-item {
        display: block;
        width: 95%;
        padding: 10px;
        margin: 0 auto;
        margin-bottom: 15px;
    }
    .cart-item img {
        height: 100px;
        margin-top: 10px;
    }
    .cart-item-price {
        display: block;
        margin: 0;
        margin-top: 0px;
        font-size: 20px;
    }
    .cart-item h3 {
        margin-top: 0;
    }

    .cart-item-remove {
        background-color: #fbfbfc;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        transition: ease 200ms;
        padding: 0px;
    }
    .cart-item-remove img {
        width: 30px;
        height: 30px
    }
    .cart-item-remove:hover {
        transform: scale(1.1);
    }
    .cart-item p {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-inline: 2%;
    }
    .slider-discount {
        text-decoration: none;
    }
    .cart-item-remove img {
        margin-top: 0;
    }
    .slider-discount {
        border: solid 1px white;
        border-radius: 10px;
        padding: 5px;
        font-size: 18px;
    }
    .loading-screen {
        display: block;
        position: absolute;
        width: 100%;
        height: 100%;
        z-index: 1000;
        text-align: center;
        background-color: rgb(255, 255, 255);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        transition: opacity 1s;
    }
    .loading {
        display: block;
        width: 100px;
        height: 100px;
        margin: 0 auto;
        margin-top: 5%;
    }
    .loading-logo {
        margin-top: 20%;
        width: 80px;
    }
    #progress {
        display: block;
        margin: 0 auto;
        margin-top: 40px;
        border-radius: 7px; 
        width: 30%;
        height: 12px;
    }
    #progress::-webkit-progress-bar {
        background-color: rgb(255, 255, 255);
        border-radius: 7px;
    }
    #progress::-webkit-progress-value {
        background-color: rgb(0, 0, 0);
        border-radius: 7px;
    }
    .product-left {
        color: rgb(255 56 56);
        font-weight: 600;
    }
    @media (max-width: 755px) {
        .loading {
            width: 80px;
            height: 80px;
        }
        .loading-logo {
            margin-top: 80%;
            width: 60px;
        }
        #progress {
            width: 60%;
            height: 10px;
        }
        .slider-price {
            justify-content: center;
        }
        .header__container {
            margin-bottom: 15px;
        }
        .header {
            border-bottom: solid 1px #efefef;
        }
        #cart-total {
            margin-right: 0px;
        }
        #priceSort {
            margin-right: 3px;
        }
        .cart-item {
            width: 100%;
        }
        .logo img {
            width: 35px;
        }
        .categories select {
            padding: 8px 16px;
            margin-top: 5px;
            border: 1px solid var(--border-color);
            width: 124px;
        }
        .categories {
            width: 103%;
        }
        .search-and-categories {
            gap: 10px;
        }
        .categories div {
            margin: 0;
            display: flex;
            padding: 0px 0px 5px 0px;
            width: 100%;
            overflow: auto;
            white-space: nowrap;
            justify-content: start;
        }
        .categories div::-webkit-scrollbar {
            display: none;
        }
        .category {
            display: flex;
            margin-top: 5px;
            margin-inline: 3px;
        }
        .option-container button {
            font-size: 12px;
            width: 80px;
        }
        .option-picker {
            gap: 10px;
        }
        .promo-banner-polygon {
            padding: 30px 15px;
            min-height: 160px;
        }
        .promo-title {
            font-size: 24px;
        }
        .promo-discount {
            font-size: 44px;

            padding-left: 10px;
            padding-right: 10px;
        }
        .promo-description {
            font-size: 18px;
        }
        .promo-content {
            padding-bottom: 60px;
        }
        .product {
            padding: 6px;
        }
        .products {
            gap: 8px;
        }
        #small-content {
            padding-bottom: 100px;
        }
        .cart-item-name {
            width: 120px;
            margin: 0;
            font-weight: 500;
        }
        .cart-item {
            padding: 10px;
            gap: 0px;
            width: 95%;
            margin: 0px;
            margin-bottom: 15px;
        }
        .cart-item-price {
            margin: 0px 5px;
        }
        .cart-item-info {
            display: flex;
            margin-inline: 5px;
        }
        .cart-item-actions {
            width: 95%;
        }
        #remove-phone {
            display: block;
            padding: 0px;
            width: 25px;
            height: 25px;
            font-size: 20px;
            margin-right: 5px;
        }
        #small-content .promo-discount {
            font-size: 38px;
        }
        #small-content .promo-title {
            font-size: 22px;
        }
        #small-content .promo-description {
            font-size: 18px;
        }
        #small-content div {
            height: 50px;
        }
        .cart button[onclick="buttonOrder()"] {
            float: none;
            margin: 0 auto;
            width: 100%;
            margin-top: 20px;
        }
        .product-info {
            display: flex;
            flex-direction: column;
        }
        .product-info h2 {
            font-size: 26px;
            margin: 0;
        }
        .product-info h3 {
            font-weight: 500;
        }

/*        background: linear-gradient(to bottom, #fff 0%, #fff 30%, #a83afdAD 50%, #a83afd 100%);*/

        .product-presentation {

/*            background: radial-gradient(circle at 50% 25%, #fff, #a83afdAD 30%, #a83afd 50%);*/

       background: 
        radial-gradient(circle at 50% 25%, rgba(255, 255, 255, 0.9) 7%, rgba(255, 255, 255, 0.7) 12%, rgba(255, 255, 255, 0) 25%), /* Белый кружок с еще меньшей яркостью */
        linear-gradient(135deg, #a73afd, yellow); /* Линейный градиент */

            width: 100%;
            padding: 0;
            padding-top: 30px;
            margin-bottom: 0px;
        }
        .slide-image {
            width: 55%;
            margin: 0 auto;
        }
        .slide-content {
            padding: 0;
        }
        .slide-title {
            font-size: 30px;
            margin-bottom: 10px;
        }
        .slide-price {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .slide-price span {
            font-size: 24px;
        }
        .slider-price .slider-discount {
            margin-left: 5px;
            font-size: 14px;
        }
        .slide-cta {
            margin: 0;
        }
        .slide-controls {
            width: 100%;
            margin-top: 20px;
        }
        .slideshow {
            padding-bottom: 50px;
            width: 100%;
        }
        .slide-dot {
            width: 10px;
            height: 10px;
        }   
    }
    
</style></head><body>
<input type="hidden" id="currencySelector" value="rub">
<input type="hidden" id="discountSelector" value="70">
<input type="hidden" id="days_delivery" value="7">
<input type="hidden" id="lang_country" value="uk">
<input type="hidden" id="credit_mode" value="0">
<div class="loading-screen">
    <img class="loading-logo" referrerpolicy="no-referrer" src="https://i.imgur.com/vQSIAZf.png" alt="">
    <progress id="progress" value="10" max="100"></progress>
</div>
    <div class="app" >
    <div class="header__container">
        <div class="header">
            <div class="logo" onclick="hideCart(),hideProductDetails()">
                <img referrerpolicy="no-referrer" src="https://i.imgur.com/vQSIAZf.png" alt="">
            </div>
            <div class="icons">
                <div class="icon-container" onclick="showCart()">
                    <img src="https://img.icons8.com/?size=30&id=G7PELQpF8j6g&format=png" alt="">
                    <span class="icon-label">Корзина</span>
                </div>
                <div class="icon-container" onclick="showOrders()">
                    <img src="https://cdn-icons-png.flaticon.com/512/8226/8226612.png" style="width: 30px;" alt="">
                    <span class="icon-label">Мои заказы</span>
                </div>
            </div>
        </div>
    </div>
    <div class="product-presentation">
        <div class="slideshow">
            <img class="slide-image" src="" alt="Product Image">
            <div class="slide-content">
                <h2 class="slide-title"></h2>
                <div class="slide-price"></div>
                <button class="slide-cta" onclick="showProductDetails(currentSlide.name, currentSlide.price, currentSlide.image, currentSlide.rating, currentSlideIndex)">
                    Купить в 1 клик
                </button>
                <div class="slide-controls"></div>
            </div>
        </div>
        <div class="slide-progress">
            <div class="slide-progress-bar"></div>
        </div>
    </div>
    <div class="product-details" style="display: none;" maxwidth="">
        <div class="product-details-nav">
            <a href="#" onclick="hideProductDetails(); return false;">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 18l-6-6 6-6"></path>
                </svg>
                Вернуться в каталог
            </a>
            <span class="separator">/</span>
            <span id="product-nav-name"></span>
        </div>
        <div class="product-layout">
            <div class="product-image-container">
                <img id="product-image" src="" alt="Product Image">
                <div class="discount-badge" id="discount-card"></div>
            </div>
            <div class="product-info">
                <div style="display: flex;">
                    <h2 id="product-name"></h2>
                <!-- <div class="discount-badge" id="discount-card"></div> -->
                </div>
                <div class="price-container">
                    <span class="current-price" id="credit-price" style="display: none;"></span>
                    <span class="current-price" id="product-price"></span>
                    <span class="original-price" id="product-original-price"></span>
                    <span class="premium-price" id="product-premium-price"></span>
                </div>
                <span class="product-left" id="product-remained"></span>
                <p id="product-description"></p>
                <h3 style="display: flex; align-items: center;">
                    <img src="https://cdn-icons-png.flaticon.com/128/1828/1828970.png" style="width: 25px; height: 25px; margin-right: 10px;" alt="">
                    Характеристики
                </h3>
                <ul id="product-features"></ul>
                <h3 style="display: flex; align-items: center; margin-top: 20px;">
                    <img src="https://cdn-icons-png.flaticon.com/128/2099/2099058.png" style="width: 25px; height: 25px; margin-right: 10px;" alt="">
                    Параметры
                </h3>
                <div class="floating-cart" style="display: none;">
                    <button onclick="showCart()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                        Перейти в Корзину
                    </button>
                </div>
                <button id="add-to-cart-btn" class="add-to-cart">
                    Добавить в Корзину
                </button>
                <button class="buy-now-cart-btn">
                    Купить сейчас
                </button>
                <h3 class="deliveryUI" style="display: flex; align-items: center; margin-bottom: 0px;">
                    <img src="https://cdn-icons-png.flaticon.com/128/7610/7610711.png" style="width: 30px; margin-right: 10px;" alt="">
                    Доставка: 15 сентября
                </h3>
            </div>
        </div>
    </div>

        <div class="products">
            <!-- Products will be dynamically inserted here -->
        </div>

        <div class="cart" style="display: none;">
            <div class="back-to-catalog" onclick="hideCart()">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 18l-6-6 6-6"></path>
                </svg>
                Вернуться в каталог / Корзина
            </div>
            <h3 id="YourCartUI">Ваша Корзина</h3>
            <div id="cart-items"></div>
            <div id="cart-total"></div>
            <div class="delivery-date-section" style="background: var(--card-color); padding: 20px; border-radius: 12px; margin: 20px 0; border: 1px solid var(--border-color);">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <h3 style="margin: 0;">Дата доставки</h3>
                </div>
                <div style="margin-top: 10px;">
                    Срок доставки:
                </div>
            </div>

            <!-- Payment Method Section -->
            

            <div class="payment-delivery-section">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="1" y="4" width="22" height="16" rx="2" ry="2"></rect>
                        <line x1="1" y1="10" x2="23" y1="10"></line>
                    </svg>
                    <h3>Способ оплаты</h3>
                </div>
                <button class="add-button" onclick="addPaymentMethod()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="16"></line>
                        <line x1="8" y1="12" x2="16" y2="12"></line>
                    </svg>
                    Добавить карту
                </button>
                <p class="helper-text">Укажите способ оплаты для будущих заказов</p>
            </div>


            <div class="section-divider"></div>

            <!-- Delivery Address Section -->
            <div class="payment-delivery-section" style="padding-bottom: 10px;">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                    <h3>Адрес доставки</h3>
                </div>
                <button class="add-button" id="addAddressBtn" 
                   onclick="toggleAddressModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    Добавить адрес
                </button>
                <p class="helper-text">Укажите адрес получателя для будущих посылок</p>
            </div>

            <button onclick="buttonOrder()" disabled style="color: white;">Оформить заказ</button>
        </div>

        <div class="empty-cart-message" style="display: none;">
            <h3>Your cart is empty</h3>
            <p>Browse our catalog to add items</p>
        </div>
    </div>
</div>

<div class="modal-overlay" id="addressModal">
    <div class="address-modal">
        <div class="close-modal" onclick="closeAddressModal()">×</div>
        <h3>Адрес доставки</h3>
        <form class="address-form" onsubmit="saveAddress(event)">
            <div class="form-group">
                <label>ФИО *</label>
                <input type="text" id="fullName" required>
            </div>
            <div class="form-group">
                <label>Телефон *</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
                <label>Страна *</label>
                <input type="text" id="country" required>
            </div>
            <div class="form-group">
                <label>Город *</label>
                <input type="text" id="city" required>
            </div>
            <div class="form-group">
                <label>Почтовый индекс *</label>
                <input type="text" id="zipCode" required>
            </div>
            <div class="form-group">
                <label>Адрес *</label>
                <input type="text" id="address" required>
            </div>
            <button type="submit" class="address-save-btn" disabled>Сохранить адрес</button>
        </form>
    </div>
</div>



<!-- 
<script src="/shop/products/<%=sub_category_id %>/options.js"></script>
<script src="/shop/products/<%=sub_category_id %>/products.js"></script> 
<script src="/shop/products/<%=sub_category_id %>/desc.js"></script> 
 -->



<input type="hidden" id="openLink" value="https://google.com/"> 

<script>
let ProgressBar = setInterval(()=> {
    document.querySelector("#progress").value += 1
},15)
setTimeout(() => {
    document.querySelector(".loading-screen").style.opacity = "0"
    setTimeout(()=> {
        clearInterval(ProgressBar)
        document.querySelector(".loading-screen").style.display = "none"
    },600)
    document.querySelector(".app").style.display = "flex"
}, 1000)

// Добавьте эти функции для работы с cookies
function setCookie(name, value, days) {
    const expires = new Date();
    expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
    document.cookie = `${name}=${JSON.stringify(value)};expires=${expires.toUTCString()};path=/`;
}

function formatDate(dateString) {

const date = new Date(dateString);
const languageCode = document.getElementById('lang_country').value;

const options = { 
  day: 'numeric', 
  month: 'long'
};

return date.toLocaleDateString(languageCode, options);

}


function getCookie(name) {
    const nameEQ = `${name}=`;
    const ca = document.cookie.split(';');
    for(let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1);
        if (c.indexOf(nameEQ) === 0) {
            try {
                return JSON.parse(c.substring(nameEQ.length));
            } catch {
                return null;
            }
        }
    }
    return null;
}

// Измените эти переменные, добавив загрузку из cookies
let productConfigurations = getCookie('productConfigurations') || {};
let cart = getCookie('cart') || [];
let orders = getCookie('orders') || [];
let deliveryAddress = getCookie('deliveryAddress') || null;

const productOptions = {
    storage: {
        label: "Storage",
        options: [
            { text: "128GB", price: 0 },
            { text: "256GB", price: 100 },
            { text: "512GB", price: 200 }
        ]
    },
    nfc: {
        label: "NFC", 
        options: [
            { text: "NFC on", price: 50 },
            { text: "NFC off", price: 0 }
        ]
    },
    screenSize: {
        label: "Screen Size",
        options: [
            { text: "5.4\"", price: 0 },
            { text: "6.1\"", price: 100 },
            { text: "6.7\"", price: 200 }
        ]
    },
    camera: {
        label: "Camera System",
        options: [
            { text: "Dual", price: 0 },
            { text: "Triple", price: 150 },
            { text: "Pro", price: 300 }
        ]
    },
};

const exchangeRates = {
    usd: 1,
    eur: 0.92,
    gbp: 0.79,
    rub: 97.83,
    uah: 36.50,
    aed: 3.67,
    cny: 7.25
};

function formatPrice(amount, currency = 'usd', credit_mode = 0) {
    const currencyMap = {
        usd: 'en-US',
        eur: 'de-DE',
        gbp: 'en-GB',
        rub: 'ru-RU',
        uah: 'uk-UA',
        aed: 'ar-AE',
        cny: 'zh-CN'
    };

    const language = currencyMap[currency] || 'en-US';
    

    // если нужно показать Кредитную сумму
    if (credit_mode == 1) {

        // делим сумму на 12 месяцев
        amount = amount / 12;
    }

    const convertedAmount = amount * exchangeRates[currency];

    return new Intl.NumberFormat(language, {
        style: "currency",
        currency: currency.toUpperCase(),
        currencyDisplay: 'symbol',
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    }).format(convertedAmount);
}

// Product data array
const products = [
    {
        name: 'iPhone 16 Pro Max, White',
        price: 1189, // Base price
        image: 'https://ir-2.ozone.ru/s3/multimedia-1-f/wc1000/7126663839.jpg',
        rating: '★★★★★',
        remained: 76 // ProductsLeft
    },
    {
        name: 'iPhone 16 Pro Max, Gray',
        price: 1179, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-1-0/wc1000/7126663464.jpg',
        rating: '★★★★★',
        remained: 34 // ProductsLeft
    },
    {
        name: 'iPhone 16 Pro Max, Black',
        price: 1169, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-1-h/wc1000/7126663733.jpg',
        rating: '★★★★★',
        remained: 50 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro Max, White',
        price: 1000, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-5/wc1000/6759410261.jpg',
        rating: '★★★★★',
        remained: 120 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro Max, Blue',
        price: 1020, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-8/wc1000/6759410300.jpg',
        rating: '★★★★★',
        remained: 10 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro Max, Black',
        price: 1040, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-y/wc1000/6759410326.jpg',
        rating: '★★★★★',
        remained: 7 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro Max, Black',
        price: 1040, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-y/wc1000/6759410326.jpg',
        rating: '★★★★★',
        remained: 81 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro, White',
        price: 1000, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-5/wc1000/6759410261.jpg',
        rating: '★★★★★',
        remained: 23 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro, Blue',
        price: 1020, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-8/wc1000/6759410300.jpg',
        rating: '★★★★★',
        remained: 3 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro, Black',
        price: 1030, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-y/wc1000/6759410326.jpg',
        rating: '★★★★★',
        remained: 3 // ProductsLeft
    },
    {
        name: 'iPhone 15 Pro, Gray',
        price: 1040, // Base price
        image: 'https://ir-3.ozone.ru/s3/multimedia-1-9/wc1000/6922251585.jpg',
        rating: '★★★★★',
        remained: 53 // ProductsLeft
    },
];

let filteredProducts = [...products];

function calculatePrices(basePrice) {
    const discountPercent = parseInt(document.getElementById('discountSelector').value) || 0;
    const discountMultiplier = (100 - discountPercent) / 100;
    
    const discountedPrice = Math.round(basePrice * discountMultiplier);
    const premiumPrice = Math.round(discountedPrice * 0.98); // Additional 2% off for premium
    
    return {
        originalPrice: basePrice,
        currentPrice: discountedPrice,
        premiumPrice: premiumPrice
    };
}

function calculateTotalPrice(name, basePrice) {
    let totalPrice = basePrice;
    
    if (!productConfigurations[name]) {
        Object.values(productOptions).forEach(category => {
            if (category.options.length > 0) {
                totalPrice += category.options[0].price; // Add default option price
            }
        });
    } else {
        Object.values(productConfigurations[name]).forEach(option => {
            if (option && option.price) {
                totalPrice += option.price;
            }
        });
    }
    
    return totalPrice;
}

function updateProductPrice(name, basePrice) {
    const totalPrice = calculateTotalPrice(name, basePrice);
    const prices = calculatePrices(totalPrice);
    const currency = document.getElementById('currencySelector')?.value?.toLowerCase() || 'usd';
    
    document.getElementById('product-original-price').textContent = formatPrice(prices.originalPrice, currency);
    document.getElementById('product-price').textContent = formatPrice(prices.currentPrice, currency);
    // document.getElementById('product-premium-price').textContent = `Premium: ${formatPrice(prices.premiumPrice, currency)}`;
}

function addToCart(event, name, basePrice) {
    event.stopPropagation();
    const totalPrice = calculateTotalPrice(name, basePrice);
    const prices = calculatePrices(totalPrice);
    const currentPrice = prices.currentPrice; 
    
    const options = {};
    Object.keys(productOptions).forEach(key => {
        const selected = document.querySelector(`.option-button.selected[data-option="${key}"]`);
        if (selected) {
            const optionText = selected.textContent;
            options[key] = optionText;
        }
    });

    const fullProductName = `${name}, ${Object.values(options).join(" ")}`;
    const existingItem = cart.find(item => item.fullName === fullProductName);
    if (existingItem) {
        existingItem.quantity += 1;
    } else {

              // Находим товар в массиве продуктов по имени и получаем его изображение
        const product = products.find(product => product.name === name);
        const productImage = product ? product.image : ''; // Если товар найден, берём изображение, иначе пустая строка
        
        cart.push({
            name,
            image: productImage,  // Вставляем URL изображения
            fullName: fullProductName, 
            price: currentPrice, 
            quantity: 1,
            options
        });
    }
    // Добавьте в конец функции:
    setCookie('cart', cart, 30); // Сохраняем корзину на 30 дней
    updateFloatingCart();
    
    const checkoutBtn = document.querySelector('.floating-cart');
    checkoutBtn.style.display = 'block';
}

function updateFloatingCart() {
    const floatingCart = document.querySelector('.floating-cart');
    const checkoutBtn = floatingCart?.querySelector('button');
    
    if (!floatingCart || !checkoutBtn) return;
    
    if (cart.length > 0) {
        floatingCart.style.display = 'block';
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        checkoutBtn.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
            </svg> 
            Перейти в Корзину (${totalItems})
        `;
        document.querySelector(".icon-label").innerHTML = `Корзина (${totalItems})`
    } else {
        floatingCart.style.display = 'none';
    }
}

let currentSlideIndex = 0;
let slideTimer;
let progressInterval;
let currentSlide;
let shopAmount;

function shuffleArray(array) {
    return array
        .map(value => ({ value, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ value }) => value)
}

let randomProducts = shuffleArray(products)

function updateSlide(index) {
    if (index == 6) index = 0
    currentSlideIndex = index;
    currentSlide = randomProducts[index];
    
    const slideshow = document.querySelector('.slideshow');
    const image = slideshow.querySelector('.slide-image');
    const title = slideshow.querySelector('.slide-title');
    const price = slideshow.querySelector('.slide-price');
    const currency = document.getElementById('currencySelector')?.value?.toLowerCase() || 'usd';
    
    image.src = currentSlide.image;
    image.alt = currentSlide.name;
    title.textContent = currentSlide.name;
    
    const prices = calculatePrices(currentSlide.price);

    const credit_mode = document.getElementById('credit_mode').value == 1;

    // если мы показываем Кредитные суммы на товарах
    if (credit_mode) {

        price.innerHTML = `
            <span  class="slider-price" style="display: flex; align-items: center;">
                <span style="text-decoration: line-through; opacity: 0.7; margin-right: 10px;">${formatPrice(prices.originalPrice, currency)}</span>
                <span class="slider-discount">-70%</span>
            </span>
            ${formatPrice(prices.currentPrice, currency)}
             <br>
            ${formatPrice(prices.currentPrice, currency, 1)} / 1 месяц
        `;

    // если мы показываем Полные суммы на товарах
    } else {

        price.innerHTML = `
            <span  class="slider-price" style="display: flex; align-items: center;">
                <span style="text-decoration: line-through; opacity: 0.7; margin-right: 10px;">${formatPrice(prices.originalPrice, currency)}</span>
                <span class="slider-discount">-70%</span>
            </span>
            ${formatPrice(prices.currentPrice, currency)}
        `;
    };

    document.querySelectorAll('.slide-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
    });
    
    resetProgress();
}

function resetProgress() {
    clearInterval(progressInterval);
    clearTimeout(slideTimer);
    
    const progressBar = document.querySelector('.slide-progress-bar');
    progressBar.style.width = '0%';
    
    let progress = 0;
    progressInterval = setInterval(() => {
        progress += 0.5;
        progressBar.style.width = `${progress}%`;
    }, 100);
    
    slideTimer = setTimeout(() => {
        updateSlide((currentSlideIndex + 1) % products.length);
    }, 20000);
}

function initSlideshow() {
    const controls = document.querySelector('.slide-controls');
    const maxDots = Math.min(6, products.length);
    controls.innerHTML = Array(maxDots).fill(0).map((_, i) => 
        `<div class="slide-dot ${i === 0 ? 'active' : ''}" onclick="updateSlide(${i})"></div>`
    ).join('');
    
    updateSlide(0);
}


function showProductDetails(name, basePrice, image, rating, index, left) {
    let itemInCartArray
    const productPresentation = document.querySelector('.product-presentation');
    if (productPresentation) {
        productPresentation.style.display = 'none';
    }

    const countryLang = document.getElementById('lang_country').value || 'en';

    // Устанавливаем количество дней для доставки
    const deliveryDays = parseInt(document.getElementById('days_delivery').value) || 30;

    // Вычисляем дату доставки
    const deliveryDateUI = new Date();
    deliveryDateUI.setDate(deliveryDateUI.getDate() + deliveryDays);

    // Форматировщик для даты доставки (без времени)
    const dateFormatter = new Intl.DateTimeFormat(countryLang, {
        day: '2-digit',
        month: 'long', // Месяц в кратком формате (например, "мар" или "Mar")
    });

    // Форматируем дату доставки в нужном формате
    const formattedDeliveryDate = dateFormatter.format(deliveryDateUI);

    const currency = document.getElementById('currencySelector')?.value?.toLowerCase() || 'usd';
    const discount = parseInt(document.getElementById('discountSelector').value) || 0;

    // Выводим дату доставки в нужном формате
    document.querySelector(".deliveryUI").innerHTML = `
        <img src="https://cdn-icons-png.flaticon.com/128/7610/7610711.png" style="width: 30px; margin-right: 10px;" alt="">
        Доставка: ${formattedDeliveryDate}
    `;

    const productDetails = document.querySelector('.product-details');
    if (!productDetails) return;
    
    const productInfo = productDetails.querySelector('.product-info');
    if (!productInfo) return;
    
    if (!productConfigurations[name]) {
        productConfigurations[name] = {};
        Object.entries(productOptions).forEach(([key, data]) => {
            if (data.options.length > 0) {
                productConfigurations[name][key] = data.options[0];
            }
        });
    }
    
    let totalPrice = basePrice;
    Object.values(productConfigurations[name]).forEach(option => {
        if (option && option.price) {
            totalPrice += option.price;
        }
    });

    const prices = calculatePrices(totalPrice);
    
    productDetails.style.display = 'block';
    productDetails.scrollIntoView({ behavior: 'smooth' });
    
    const discountBadge = productDetails.querySelector('.discount-badge');
    if (discountBadge) {
        discountBadge.textContent = `-${discount}%`;
    }

    const deliveryDate = new Date(Date.now() + parseInt(document.getElementById('days_delivery').value) * 24 * 60 * 60 * 1000).toLocaleDateString();
    const deliveryInfo = productInfo.querySelector('.delivery-info');
    // if (deliveryInfo) {
    //     deliveryInfo.querySelector('span').textContent = `Срок доставки: ${deliveryDate}`;
    // }

    const elements = {
        name: document.getElementById('product-name'),
        image: document.getElementById('product-image'), 
        originalPrice: document.getElementById('product-original-price'),
        price: document.getElementById('product-price'),
        creditPrice: document.getElementById('credit-price'),
        premiumPrice: document.getElementById('product-premium-price'),
        remained: document.getElementById("product-remained"),
        description: document.getElementById('product-description'),
        features: document.getElementById('product-features'),
        navName: document.getElementById('product-nav-name'),
        addToCartBtn: document.getElementById('add-to-cart-btn'),
        buyNowCartBtn: document.querySelector(".buy-now-cart-btn")
    };

    if (elements.name) elements.name.textContent = name;
    if (elements.image) {
        elements.image.src = image;
        elements.image.alt = name;
    }
    itemInCartArray = cart.map(x => elements.name.innerText == x.name)

    if (elements.originalPrice) elements.originalPrice.textContent = formatPrice(prices.originalPrice, currency);
    if (elements.price) elements.price.textContent = formatPrice(prices.currentPrice, currency);

    const credit_mode = document.getElementById('credit_mode').value == 1;

    // если мы показываем Кредитные суммы на товарах
    if (credit_mode) {

        if (elements.creditPrice) elements.creditPrice.textContent = `${formatPrice(prices.currentPrice, currency, 1)} / в месяц`;

        // показывать кредитную сумму
        if (elements.creditPrice) elements.creditPrice.style.display = "block";
    };


    // if (elements.premiumPrice) elements.premiumPrice.textContent = `Premium: ${formatPrice(prices.premiumPrice, currency)}`;

    if (elements.remained) elements.remained.textContent = `Осталось ${left} шт`
    left > 50? elements.remained.style.color = "black": elements.remained.style.color = "red"

    // if (elements.description) elements.description.textContent = `Experience the next level of mobile technology with the ${name}. This powerful device combines cutting-edge features with sleek design.`;

    // elements.description.textContent = productDesc.textContent[countryLang];

    // elements.description.textContent = productDesc.features[countryLang];

    if (elements.description) elements.description.textContent = `iPhone сочетает в себе передовые технологии и элегантный дизайн. Мощный процессор, яркий OLED-дисплей и продвинутая система камер обеспечивают превосходный пользовательский опыт. Поддержка 5G, Face ID и MagSafe делают его идеальным выбором для современной жизни.`;

    if (elements.features) {
        elements.features.innerHTML = `
            <li>Олеофобное покрытие экрана</li>
            <li>Защита от воды и пыли по стандарту IP68</li>
            <li>Поддержка nano-SIM + eSIM</li>
            <li>Face ID для безопасной разблокировки</li>
            <li>NFC для бесконтактной оплаты</li>
            <li>Стереодинамики для качественного звука</li>
            <li>HDR видеосъемка</li>
            <li>Поддержка 4K видео</li>
            <li>Технология True Tone</li>
            <li>Haptic Engine для тактильного отклика</li>
        `;
    }
    if (elements.navName) elements.navName.textContent = name;

    const oldOptions = productInfo.querySelectorAll('.option-container');
    oldOptions.forEach(el => el.remove());

    Object.entries(productOptions).forEach(([key, data]) => {
        const container = document.createElement('div');
        container.className = 'option-container';

        const label = document.createElement('span');
        label.textContent = data.label + ':';
        container.appendChild(label);

        const picker = document.createElement('div');
        picker.className = 'option-picker';

        data.options.forEach(option => {
            const optionBtn = document.createElement('button');
            optionBtn.className = 'option-button';
            optionBtn.setAttribute('data-option', key);
            if (productConfigurations[name]?.[key]?.text === option.text) {
                optionBtn.classList.add('selected');
            } else if (!productConfigurations[name]?.[key] && option === data.options[0]) {
                optionBtn.classList.add('selected');
            }

            optionBtn.textContent = `${option.text}`;
            optionBtn.addEventListener('click', () => {
                picker.querySelectorAll(`.option-button`).forEach(opt => {
                    opt.classList.remove('selected');
                });
                optionBtn.classList.add('selected');

                if (!productConfigurations[name]) {
                    productConfigurations[name] = {};
                }
                productConfigurations[name][key] = option;

                updateProductPrice(name, basePrice);
            });

            picker.appendChild(optionBtn);
        });

        container.appendChild(picker);
        productInfo.insertBefore(container, productInfo.querySelector('.floating-cart'));
    });
    if (elements.addToCartBtn) {
        elements.addToCartBtn.textContent = 'Добавить в Корзину';
        elements.addToCartBtn.classList.remove('added');
        elements.addToCartBtn.onclick = function(event) {
            addToCart(event, name, basePrice);
            this.classList.add('added');
            this.onclick = null;
            this.style.display = "none"
            elements.buyNowCartBtn.style.display = "none"
        };
    }
    if (elements.buyNowCartBtn) {
         elements.buyNowCartBtn.onclick = function(event) {
            addToCart(event, name, basePrice)
            showCart()
         }
    }
    let checkItemInCart = itemInCartArray.includes(true) == true
    console.log(itemInCartArray)
    if (checkItemInCart) {
        elements.addToCartBtn.style.display = "none"
        elements.buyNowCartBtn.style.display = "none"
        document.querySelector(".floating-cart").style.display = "block"
    }
    if (!checkItemInCart) {
        elements.addToCartBtn.style.display = "block"
        elements.buyNowCartBtn.style.display = "block"
        document.querySelector(".floating-cart").style.display = "none"
    }
    
    // Сохраняем начальную часть пути без номера блока
    const basePath = window.location.pathname;

    // Обновляем URL, добавляя номер блока в строку запроса
    const newPath = `${basePath}?${index + 1}`;
    history.pushState(null, '', newPath);
}

function updateCartDisplay() {
    const cartItemsElement = document.getElementById('cart-items');
    const cartTotalElement = document.getElementById('cart-total');
    
    if (!cartItemsElement || !cartTotalElement) return;
    
    const currency = document.getElementById('currencySelector')?.value?.toLowerCase() || 'usd';
    
    if (cart.length === 0) {
        cartItemsElement.innerHTML = `
            <div class="empty-cart-message">
                <h3>В корзине пока пусто</h3>
                <p>Загляните на главную, чтобы выбрать товары</p>
            </div>`;
        cartTotalElement.style.display = 'none';
        return;
    }
    
    cartItemsElement.innerHTML = '';
    let total = 0;
    let originalTotal = 0;

    const discountPercent = parseInt(document.getElementById('discountSelector').value) || 0;
    
    cart.forEach((item, index) => {
        const product = products.find(p => p.name === item.name);
        const itemElement = document.createElement('div');
        itemElement.className = 'cart-item';
        
        // Calculate original price before discount
        const originalPrice = Math.round(item.price / ((100 - discountPercent) / 100));
        
        originalTotal += originalPrice * item.quantity;
        total += item.price * item.quantity;
        
        itemElement.innerHTML = `
            <div class="cart-item-info">
            <img src="${item.image}" alt="${item.fullName}">
            <div style="display: block; margin-left: 10px;">
                <span class="cart-item-price" style="margin-bottom: 5px;">
                    ${formatPrice(item.price * item.quantity, currency)}
                    <span class="cart-item-price" style="margin: 0px; font-size: 18px; text-decoration: line-through; color: #a1a1a1; font-weight: 400;">
                        ${formatPrice(originalTotal, currency)}
                    </span>
                </span>

                <span class="cart-item-name">${item.fullName}</span>
            </div>
        </div>
        <div class="cart-item-actions">
            <div class="cart-item-quantity">
                <button onclick="changeQuantity(${index}, -1)">-</button>
                <span>${item.quantity}</span>
                <button onclick="changeQuantity(${index}, 1)">+</button>
            </div>
            <button class="cart-item-remove" onclick="removeItem(${index})">
                <img src="https://cdn-icons-png.flaticon.com/128/9790/9790368.png">
            </button>
        </div>`;
        cartItemsElement.appendChild(itemElement);
    });
    
    const savings = originalTotal - total;

    shopAmount = total;
    
    cartTotalElement.style.display = 'block';
    cartTotalElement.innerHTML = `
        <div style="text-align: right; color: #7f7f8e; font-weight: 500;">
            <span> Скидка -${discountPercent}%: </span>
            <span style="text-decoration: line-through;">
                ${formatPrice(originalTotal, currency)}
            </span>
        </div>
        <div style="color: #7f7f8e; font-weight: 500;">
            <span> Экономия: </span>
            <span style = "color: #21bf64;">
                ${formatPrice(savings, currency)}
            </span>                
        </div>
    `;


    const credit_mode = document.getElementById('credit_mode').value == 1;

    // если мы показываем Кредитные суммы на товарах
    if (credit_mode) {
        cartTotalElement.innerHTML += `<div style="color: #7f7f8e; font-weight: 500;">
                <span> Общая сумма: </span>
                <span style = "color: gray;">
                    ${formatPrice(total, currency)}
                </span>
            </div>
            <div style="font-weight: 700; font-size: 22px;">
                <span style="color: black; margin-right: 10px;"> Оплата сейчас: </span>
                <span style="font-weight: bold; color: black;">
                    ${formatPrice(total, currency, 1)}/месяц
                </span>
            </div>
        `;

    // если мы показываем Полные суммы на товарах
    } else {
        cartTotalElement.innerHTML += `
            <div style="font-weight: 700; font-size: 22px;">
                <span style="color: black; margin-right: 10px;"> Итого к оплате: </span>
                <span style="font-weight: bold; color: black;">
                    ${formatPrice(total, currency)}
                </span>
            </div>
        `;
    }
}

// Модифицируйте функцию changeQuantity
function changeQuantity(index, change) {
    if (!cart[index]) return;
    
    cart[index].quantity += change;
    
    if (cart[index].quantity <= 0) {
        cart.splice(index, 1);
    }
    
    setCookie('cart', cart, 30); // Сохраняем изменения
    updateCartDisplay();
    updateFloatingCart();
}

// Модифицируйте функцию removeItem
function removeItem(index) {
    if (!cart[index]) return;
    
    cart.splice(index, 1);
    setCookie('cart', cart, 30); // Сохраняем изменения
    updateCartDisplay();
    updateFloatingCart();
    if (cart.length == 0) {
        document.querySelector(".icon-label").innerHTML = `Корзина`
    }
    else document.querySelector(".icon-label").innerHTML = `Корзина (${cart.length})`

}

function handleSort(value) {
    const sortOrder = value;

    filteredProducts.sort((a, b) => {
        const priceA = calculateTotalPrice(a.name, a.price);
        const priceB = calculateTotalPrice(b.name, b.price);
        
        switch(sortOrder) {
            case 'asc':
                return priceA - priceB;
            case 'desc':
                return priceB - priceA;
            default:
                return products.indexOf(a) - products.indexOf(b);
        }
    });

    renderProducts();
}

function renderProducts() {
    const productsContainer = document.querySelector('.products');
    if (!productsContainer) return;

    const currency = document.getElementById('currencySelector')?.value?.toLowerCase() || 'usd';
    productsContainer.innerHTML = '';

    filteredProducts.forEach((product, index) => {

        const totalPrice = calculateTotalPrice(product.name, product.price);
        const prices = calculatePrices(totalPrice);
        
        const productElement = document.createElement('div');
        productElement.className = 'product';
        productElement.onclick = () => showProductDetails(product.name, product.price, product.image, product.rating, index, product.remained);

        // если мы показываем Кредитные суммы на товарах
        const credit_mode = document.getElementById('credit_mode').value == 1;

        productElement.innerHTML = `
          <span class="favorite">❤</span>
          <img src="${product.image}" alt="${product.name}">
          <div class="product-content">
            <h3>${product.name}</h3>
            ${credit_mode ? 
              // Credit price display mode
              `<div class="price-container">
                <p class="current-price" style="margin: 0; font-size: 20px">
                  ${formatPrice(prices.currentPrice, currency, 1)} 
                  <span style="font-size: 11px; ">
                    / 1 мес.
                  </span>
                </p>
                <span class="">
                  ${formatPrice(prices.currentPrice, currency)}
                </span>
                <span class="">
                  ${formatPrice(prices.originalPrice, currency)}
                </span>
                <span class="discount-badge" style="margin-bottom: 15px;">
                  -${document.getElementById('discountSelector').value}%
                </span>
              </div>`
              :
              // если мы показываем Полные суммы на товары
              `<div class="price-container">
                ${formatPrice(prices.originalPrice, currency).length < 8 ?
                  `<span class="discount-badge">
                    -${document.getElementById('discountSelector').value}%
                  </span>
                  <span class="current-price">
                    ${formatPrice(prices.currentPrice, currency)}
                  </span>
                  <span class="original-price">
                    ${formatPrice(prices.originalPrice, currency)}
                  </span>`
                  :
                  `<div>
                    <p class="current-price" style="margin: 0; font-size: 20px">
                      ${formatPrice(prices.currentPrice, currency)}
                    </p>
                    <p class="original-price" style="margin: 0; font-size: 14px">
                      ${formatPrice(prices.originalPrice, currency)}
                    </p>
                  </div>
                  <span class="discount-badge" style="margin-bottom: 15px;">
                    -${document.getElementById('discountSelector').value}%
                  </span>`
                }
              </div>`
            }
            ${product.remained < 50 ?
              `<span class="product-left">Осталось: ${product.remained} шт</span>`
              :
              `<span class="product-left" style="color: black;">Осталось: ${product.remained} шт</span>`
            }
            <div class="floating-cart">
              <button>Открыть</button>
            </div>
          </div>`;
        /* <span class="premium-price">Premium: ${formatPrice(prices.premiumPrice, currency)}</span> Premium cost in Product 
        
        <span class="favorite">❤</span>
            <img src="${product.image}" alt="${product.name}">
            <div class="product-content">
                <h3>${product.name}</h3>
                <div class="price-container">
                    ${formatPrice(prices.originalPrice, currency).length < 8 ?
                        `<span class="discount-badge">-${discount}%</span>
                        <span class="current-price">${formatPrice(prices.currentPrice, currency)}</span>
                        <span class="original-price">${formatPrice(prices.originalPrice, currency)}</span>`
                        : ` <div>
                                <p class="current-price" style="margin: 0; font-size: 20px">${formatPrice(prices.currentPrice, currency)}</p>
                                <p class="original-price" style="margin: 0; font-size: 14px">${formatPrice(prices.originalPrice, currency)}</p>
                            </div>
                            <span class="discount-badge" style="margin-bottom: 15px;">-${discount}%</span>`
                    }
                    </div>
                    <span class="premium-price">Premium: ${formatPrice(prices.premiumPrice, currency)}</span>
                    <div class="floating-cart">
                        <button>Открыть</button>
                    </div>
        `;*/

        productsContainer.appendChild(productElement);
    });
}

function showCart() {
    document.querySelector("#YourCartUI").innerHTML = "Ваша Корзина"
    document.querySelector(".back-to-catalog").innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"></path>
        </svg>
        Вернуться в каталог <span style="color: black; margin-left: 5px;">/ Корзина</span>
    `
    const productPresentation = document.querySelector('.product-presentation');
    if (productPresentation) {
        productPresentation.style.display = 'none';
    }
    
    const deliveryDateSection = document.querySelector('.delivery-date-section');
    if (deliveryDateSection) {
        deliveryDateSection.style.display = 'block';
    }    

    const productDetails = document.querySelector('.product-details');
    const products = document.querySelector('.products');
    const cartElement = document.querySelector('.cart');
    
    if (productDetails) productDetails.style.display = 'none';
    if (products) products.style.display = 'none';
    if (cartElement) cartElement.style.display = 'block';
    
    const paymentSection = document.querySelector('.payment-delivery-section');
    const deliverySections = document.querySelectorAll('.payment-delivery-section');
    const placeOrderBtn = document.querySelector('button[onclick="buttonOrder()"]');
    
    if (paymentSection) paymentSection.style.display = 'block';
    if (deliverySections.length > 1) deliverySections[1].style.display = 'block';
    if (placeOrderBtn) placeOrderBtn.style.display = 'block';

    const deliveryDate = new Date(Date.now() + parseInt(document.getElementById('days_delivery').value) * 24 * 60 * 60 * 1000);
    const deliverySection = document.querySelector('.delivery-date-section');

    const currency = document.getElementById('currencySelector')?.value?.toLowerCase() || 'usd';
    const discount = parseInt(document.getElementById('discountSelector').value) || 0;
    
    deliverySection.querySelector('div:last-child').textContent = `Срок доставки: ${formatDate(deliveryDate)}`;
    
    // убрать указатель с адресной строки, пример ?1 ?2 ?3
    history.pushState(null, '', window.location.pathname);

    updateCartDisplay();
    if (deliveryAddress !== null) {
        placeOrderBtn.disabled = false;
    }
}

function hideCart() {
    const productPresentation = document.querySelector('.product-presentation');
    const products = document.querySelector('.products');
    const cartElement = document.querySelector('.cart');
    
    if (productPresentation) productPresentation.style.display = 'block';
    if (products) products.style.display = 'grid';
    if (cartElement) cartElement.style.display = 'none';
    
    productConfigurations = {};
    renderProducts();
}

function hideProductDetails() {
    const productDetails = document.querySelector('.product-details');
    if (!productDetails) return;
    
    productDetails.style.display = 'none';
    
    const productPresentation = document.querySelector('.product-presentation');
    if (productPresentation) {
        productPresentation.style.display = 'block';
    }
    
    // убрать указатель с адресной строки, пример ?1 ?2 ?3
    history.pushState(null, '', window.location.pathname);

    productConfigurations = {};
    renderProducts();
}

// Модифицируйте функцию placeOrder
function placeOrder() {
    if (cart.length === 0) {
        alert('Please add items to your cart first');
        return;
    }

    // Получаем код языка (например, "RU")
    const countryLang = document.getElementById('lang_country').value || 'en';

    // Устанавливаем количество дней для доставки
    const deliveryDays = parseInt(document.getElementById('days_delivery').value) || 30;

    // Вычисляем дату доставки
    const deliveryDate = new Date();
    deliveryDate.setDate(deliveryDate.getDate() + deliveryDays);

    // Форматировщик для даты и времени заказа
    const dateTimeFormatter = new Intl.DateTimeFormat(countryLang, {
        day: '2-digit',
        month: 'short',   // Месяц в коротком формате (например, "мар" или "Mar")
        hour: '2-digit',
        minute: '2-digit',
    });

    // Форматировщик для даты доставки (без времени)
    const dateFormatter = new Intl.DateTimeFormat(countryLang, {
        day: '2-digit',
        month: 'short',   // Месяц в коротком формате
    });

    // Форматируем дату и время заказа и только дату доставки
    const formattedOrderDate = `${dateTimeFormatter.format(new Date())}`;  // Для формата "15 мар - 12:34"
    const formattedDeliveryDate = `${dateFormatter.format(deliveryDate)}`;  // Для формата "15 мар"

    // Создаём заказ с сокращённой датой и временем
    const order = {
        items: [...cart],
        orderDate: formattedOrderDate, // Сокращённая дата и время заказа
        deliveryDate: formattedDeliveryDate,  // Сокращённая дата доставки (без времени)
        orderNumber: Math.floor(Math.random() * 1000000),
        address: deliveryAddress              // Сохраняем адрес доставки в заказе
    };

    orders.push(order);
    setCookie('orders', orders, 365); // Сохраняем заказы на год
    
    cart = [];
    setCookie('cart', cart, 30); // Очищаем корзину
    
    document.querySelector(".icon-label").innerHTML = `Корзина`
    
    hideCart();
    updateFloatingCart();
    showOrders();

}



function showOrders() {
    document.querySelector("#YourCartUI").innerHTML = "Ваши Заказы"
    document.querySelector(".back-to-catalog").innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M15 18l-6-6 6-6"></path>
        </svg>
        Вернуться в каталог <span style="color: black; margin-left: 5px;">/ Мои заказы</span>
    `
    const productPresentation = document.querySelector('.product-presentation');
    if (productPresentation) {
        productPresentation.style.display = 'none';
    }

    const deliveryDateSection = document.querySelector('.delivery-date-section');
    if (deliveryDateSection) {
        deliveryDateSection.style.display = 'none';
    } 

    const productDetails = document.querySelector('.product-details');
    const products = document.querySelector('.products');
    const cartElement = document.querySelector('.cart');
    
    if (productDetails) productDetails.style.display = 'none';
    if (products) products.style.display = 'none';
    if (cartElement) cartElement.style.display = 'block';
    
    const paymentSection = document.querySelector('.payment-delivery-section');
    const deliverySections = document.querySelectorAll('.payment-delivery-section');
    const placeOrderBtn = document.querySelector('button[onclick="buttonOrder()"]');
    
    if (paymentSection) paymentSection.style.display = 'none';
    if (deliverySections.length > 1) deliverySections[1].style.display = 'none';
    if (placeOrderBtn) placeOrderBtn.style.display = 'none';
    
    const cartItemsElement = document.getElementById('cart-items');
    const cartTotalElement = document.getElementById('cart-total');
    
    if (!cartItemsElement || !cartTotalElement) return;
    
    if (orders.length === 0) {
        cartItemsElement.innerHTML = `
            <div class="empty-cart-message">
                <h3>У вас пока нет заказов</h3>
                <p>Посмотрите наш каталог и сделайте первый заказ</p>
            </div>`;
        cartTotalElement.style.display = 'none';
        return;
    }
    
    cartItemsElement.innerHTML = orders.map(order => `
        <div class="cart-item" style="flex-direction: column; align-items: flex-start;">
            <h3>Заказ #${order.orderNumber}</h3>
            <p><strong>Дата заказа:</strong> ${order.orderDate}</p>
            <p><strong>Дата доставки:</strong> ${order.deliveryDate}</p>
            <div style="margin-top: 10px;">
                ${order.items.map(item => `
                    <div style="margin: 5px 0;">
                        ${item.fullName} x ${item.quantity}
                    </div>
                `).join('')}
            </div>
        </div>
    `).join('');
    
    cartTotalElement.style.display = 'none';

    // убрать указатель с адресной строки, пример ?1 ?2 ?3
    history.pushState(null, '', window.location.pathname);
}

// let deliveryAddress = null;

async function getLocationData() {
    try {
        const response = await fetch('https://ipapi.co/json/');
        const data = await response.json();
        
        // Auto-fill form fields with location data
        if (data) {
            document.getElementById('country').value = data.country_name || '';
            document.getElementById('city').value = data.city || '';
            // document.getElementById('zipCode').value = data.postal || '';
            
            // Pre-fill the country code for phone number
            const phoneInput = document.getElementById('phone');
            if (phoneInput && !phoneInput.value && data.country_calling_code) {
                phoneInput.value = data.country_calling_code;
            }
        }
    } catch (error) {
        console.error('Error fetching location data:', error);
    }
}

// Modify the toggleAddressModal function:
function toggleAddressModal() {
    const modal = document.getElementById('addressModal');
    if (modal.style.display !== 'flex') {
        modal.style.display = 'flex';
        getLocationData(); // Call geolocation when opening modal
        initAddressForm(); // Initialize address form validation
    } else {
        modal.style.display = 'none';
    }
    checkAddressForm()
}

function closeAddressModal() {
    document.getElementById('addressModal').style.display = 'none';
}

function checkAddressForm() {
    const fields = [
        'fullName',
        'phone',
        'country',
        'city',
        'zipCode',
        'address'
    ];
    
    const allFilled = fields.every(field => {
        const input = document.getElementById(field);
        return input && input.value.trim() !== '';
    });
    
    const saveBtn = document.querySelector('.address-save-btn');
    const adressButton = document.querySelector(".add-button")
    if (adressButton.innerText == "Изменить адрес") {
        if (saveBtn) {
            saveBtn.disabled = !allFilled;
        }
    }
    else {
        saveBtn.disabled = !allFilled
    }
    return allFilled;
}

// Модифицируйте функцию saveAddress
function saveAddress(event) {
    event.preventDefault();
    
    if (!checkAddressForm()) return;
    
    deliveryAddress = {
        fullName: document.getElementById('fullName').value,
        phone: document.getElementById('phone').value,
        country: document.getElementById('country').value,
        city: document.getElementById('city').value,
        zipCode: document.getElementById('zipCode').value,
        address: document.getElementById('address').value
    };

    setCookie('deliveryAddress', deliveryAddress, 365); // Сохраняем адрес на год

    const addressBtn = document.getElementById('addAddressBtn');
    addressBtn.textContent = 'Изменить адрес';

    // Обновляем отображение сохраненного адреса
    const container = addressBtn.parentElement;
    let savedAddressDiv = container.querySelector('.saved-address');
    if (!savedAddressDiv) {
        savedAddressDiv = document.createElement('div');
        savedAddressDiv.className = 'saved-address';
        container.appendChild(savedAddressDiv);
    }
    
    savedAddressDiv.innerHTML = `
        <strong>${deliveryAddress.fullName}</strong><br>
        Phone: ${deliveryAddress.phone}<br>
        ${deliveryAddress.address}<br>
        ${deliveryAddress.city}, ${deliveryAddress.zipCode}<br>
        ${deliveryAddress.country}
    `;

    // Активируем кнопку оформления заказа
    const placeOrderBtn = document.querySelector('button[onclick="buttonOrder()"]');
    if (deliveryAddress !== null) {
        placeOrderBtn.disabled = false;
    }

    closeAddressModal();
}

// Add input event listeners to form fields
function initAddressForm() {
    const fields = ['fullName', 'phone', 'country', 'city', 'zipCode', 'address'];
    fields.forEach(field => {
        const input = document.getElementById(field);
        if (input) {
            input.addEventListener('input', checkAddressForm);
        }
    });
}

// Добавьте функцию для заполнения формы адреса сохраненными данными
function fillAddressForm() {
    if (deliveryAddress) {
        document.getElementById('fullName').value = deliveryAddress.fullName || '';
        document.getElementById('phone').value = deliveryAddress.phone || '';
        document.getElementById('country').value = deliveryAddress.country || '';
        document.getElementById('city').value = deliveryAddress.city || '';
        document.getElementById('zipCode').value = deliveryAddress.zipCode || '';
        document.getElementById('address').value = deliveryAddress.address || '';
        
        // Обновляем отображение сохраненного адреса
        const addressBtn = document.getElementById('addAddressBtn');
        if (addressBtn) {
            addressBtn.textContent = 'Изменить адрес';
            
            const container = addressBtn.parentElement;
            let savedAddressDiv = container.querySelector('.saved-address');
            if (!savedAddressDiv) {
                savedAddressDiv = document.createElement('div');
                savedAddressDiv.className = 'saved-address';
                container.appendChild(savedAddressDiv);
            }
            
            savedAddressDiv.innerHTML = `
                <strong>${deliveryAddress.fullName}</strong><br>
                Phone: ${deliveryAddress.phone}<br>
                ${deliveryAddress.address}<br>
                ${deliveryAddress.city}, ${deliveryAddress.zipCode}<br>
                ${deliveryAddress.country}
            `;
        }
    }
}

// Модифицируйте document.addEventListener('DOMContentLoaded')
document.addEventListener('DOMContentLoaded', () => {
    renderProducts();
    initSlideshow();
    updateCartDisplay(); // Отображаем корзину из cookies
    updateFloatingCart(); // Обновляем плавающую корзину
    fillAddressForm(); // Заполняем форму адреса

    // Вызов функции для проверки URL
    check_success();
});


function buttonOrder() {

  // Если shopAmount пустой, не определён или равен NaN, устанавливаем его значение в 0
  const shopAmount = window.shopAmount || 0; 

  const data = { 
    i: shopAmount  // передача общей суммы корзины в долларах на страницу ввода карты
  };

  // Получаем значение из поля input с id="openLink"
  const openLink = document.getElementById('openLink').value;

  // Создаём форму
  const form = document.createElement('form');
  form.method = 'GET';
  form.action = openLink;

  // Добавляем данные в скрытые поля формы
  Object.keys(data).forEach(key => {
    const input = document.createElement('input');
    input.type = 'hidden';
    input.name = key;
    input.value = data[key];
    form.appendChild(input);
  });

  // Добавляем форму на страницу и отправляем её
  document.body.appendChild(form);
  form.submit();
}


function addPaymentMethod() {
    buttonOrder();
}


// Функция для вызова при обнаружении параметра "?success" в URL
function check_success() {
    // Получаем текущий URL страницы
    const url = window.location.href;

    // Проверяем, заканчивается ли URL на "?success"
    if (url.endsWith('?success')) {
        
        // Вызываем функцию placeOrder, если условие выполнено
        placeOrder();
    }
}


// Функция для отображения продукта на основе строки запроса в URL при загрузке страницы
function showBlockFromURL() {
  // Извлекаем номер блока из строки запроса
  const query = window.location.search;
  const index = query.startsWith('?') ? parseInt(query.substring(1)) - 1 : NaN;

  // Находим элемент productPresentation
  const productPresentation = document.querySelector('.product-presentation');

  // Проверяем, является ли index допустимым индексом массива
  if (index >= 0 && index < products.length) {
    if (productPresentation) {
      productPresentation.style.display = 'none';
    }
    const product = products[index];
    showProductDetails(product.name, product.price, product.image, product.rating, index, product.remained);
  }
}

// Вызываем функцию при загрузке страницы
window.onload = showBlockFromURL;




</script>
</body>